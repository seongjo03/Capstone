<html>
    <head>
        
        <!--
        <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; media-src *">
        
        <meta name="format-detection" content="telephone=no">
        <meta name="msapplication-tap-highlight" content="no">
        -->
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
        <!--<link rel="stylesheet" type="text/css" href="css/index.css">-->
		
        
        
        <!-- Jquery mobile CDN***************************** 
        <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
        <script src="http://code.jquery.com/jquery-1.7.0.min.js"></script>
        <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
        -->
        
        <!-- Bootstrap CDN*****************************
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
         -->
        
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script src="js/lib/bootstrap.min.js"></script>
        
        <link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css">
        <script src="js/lib/jquery-1.12.2.min.js"></script>
        <script src="js/lib/jquery.mobile-1.4.5.min.js"></script>
        
        
        <script src="js/lib/jquery.ajax-cross-origin.min.js"></script>
        
        <!--
        <script src="xml2json.js"></script>
        <script src="jquery.xdomainajax.js"></script>
        -->
        
        
		
        <title>Hello World</title>
		<style>
            .ui-page{
                background-color : #00bdaa;
            }
            .ui-btn{
                color : #aa0000;
            }
			#LoginPage{
				font-family: "Times New Roman", Times, serif;
			}
            body{
                background-color : #00bdaa;
            }
            .stat1{
                width:32%; border:solid; background-color:white; display:inline-table; margin-right:3px; margin-bottom:3px; text-shadow:0 0 0;
            }
            .stat2{
                width:32%; border:solid; background-color:#222222; color:red; display:inline-table; margin-right:3px; margin-bottom:3px; text-shadow:0 0 0;
            }
		</style>
        
        
    </head>
    
    <script type="text/javascript">
        
    </script>
        
    <body>
        
        <!-- Login page**************************** -->
        
        <script type="text/javascript">
            var intervalRoomInfo;
            var listinterval = 5000;
            var detailinterval = 5000;
        
            $(document).ready(function () {
                setInterval("$('.blink').fadeOut().fadeIn();",3000);
                
                $('#loginBtn').click(function() {
                    //alert($('#email').val()+ " " + $('#pass').val());
                    //alert("Login Success");
                    //$.mobile.changePage( "#bcpage", { transition: "flip", changeHash: false });
                    $.ajax({
                            
                        //type: "GET",
                        //url: "./login.php",                                 // use for desktop
                        url: "http://seongjo03.gonetis.com/capstone/login.php",   // use for mobile
                        //data: "email="+$("#email").val()+"&pass="+$("#pass").val(),
                        
                        data: {email: $("#email").val(),
                                pass: $("#pass").val()},
                        dataType: "json",
                        //crossDomain: true,
                        success: function(json){
                            var data = JSON.parse(json);            //Parsing JSON data
                        
                            if(data == 1){                 // if user sign in successfully,
                            
                                $.ajax({
                                    url:"http://seongjo03.gonetis.com/capstone/buildings.php",
                                    success: function(json){
                                        var data = JSON.parse(json);
                                        var tester = "";
                                        
                                        var source1 = "";
                                        var source2 = "";
                                        
                                        for(var i in data.b_alias){
                                            tester = tester + "<div class='item active' onclick='javascript:buildingInfo('" + data.b_alias[i] + "')'>\n";
                                            if (i == 0) {
                                                source1 = source1
                                                    + "<li data-target='#myCarousel' data-slide-to='" + i + "' class='active'></li>\n";
                                                
                                                source2 = source2
                                                    +"<div class='item active' onclick='javascript:buildingInfo(\"" + data.b_alias[i] + "\")'>"
                                                    +    "<img src='http://seongjo03.gonetis.com/capstone/buildingIMG/" + data.b_alias[i] + ".jpg' alt='" + data.b_alias[i] + "'>"
                                                    //+    "<img src='img/Building_A.jpg'>"
                                                    +    "<div class='carousel-caption'><h3>" + data.b_alias[i] + "</h3>"
                                                    +    "<p>" + data.b_etc[i] + "</p></div></div>";
                                            }else{
                                                source1 = source1
                                                    +"<li data-target='#myCarousel' data-slide-to='" + i + "'></li>\n";
                                                
                                                source2 = source2
                                                    +    "<div class='item' onclick='javascript:buildingInfo(\"" + data.b_alias[i] + "\")'>"
                                                    +    "<img src='http://seongjo03.gonetis.com/capstone/buildingIMG/" + data.b_alias[i] + ".jpg' alt='" + data.b_alias[i] + "'>"
                                                    +    "<div class='carousel-caption'><h3>" + data.b_alias[i] + "</h3>"
                                                    +    "<p>" + data.b_etc[i] + "</p></div></div>";
                                            }   
                                        }
                                        
                                        $('#carousel-indicators').html(source1);
                                        $('#carousel-inner').html(source2);
                                        
                                        element = document.getElementById('carousel-indicators');
                                        var searchThis = element.innerHTML;
                                        //alert(searchThis);
                                        //alert(tester);
                                        
                                    },
                                    error: function failCallBk(XMKHttpRequest, textStatus, errorThrown){
                                        alert(XMKHttpRequest.status + " " + XMKHttpRequest.statusText + " " + errorThrown + "\n" +"An error occured while processing your request. Please try again.");
                                    } 
                                });
                            
                            
                                $.mobile.changePage( "#bcpage", 
                                    { transition: "pop", 
                                    changeHash: true, 
                                    reverse :true }
                                );
                            }else{
                                alert("Incorrect ID or Password.");
                            }
                        },
                        error: function failCallBk(XMKHttpRequest, textStatus, errorThrown){
                            alert(XMKHttpRequest.status + " " + XMKHttpRequest.statusText + " " + errorThrown + "\n" +"An error occured while processing your request. Please try again.");
                        } 
                    });
                });
            });
            
            function buildingInfo(building){
                clearInterval(intervalRoomInfo);
                var rooms = [];
            
                $.ajax({
                    url:"http://seongjo03.gonetis.com/capstone/rooms.php",
                    data: {r_building: building},
                    dataType: "json",
                    success: function(json){
                        
                        //var data = JSON.parse(json);
                        var tester = "";
                        
                        var strfl = json.r_roomno[0] + "";
                        var floor = strfl.charAt(0);
                        var collapseno = "collapse"+floor;
                        
                        if (floor == 'u'){
                            var source = "<h2>" + building + "</h2>"
                                        + "<p>empty</p>";
                        }else{
                            var source = "<h2>" + building + "</h2>"
                                    +"<div class='accordion-group'>"
                                    +"<div class='accordion-heading'>"
                                    +"<a class='accordion-toggle' data-toggle='collapse' href='#" + collapseno + "'>" + floor + "F</a> </div>"
                                    +"<div id='" + collapseno + "' class='accordion-body collapse in'>"
                                    +"<div class='accordion-inner'>";
                                    
                            for(var i in json.r_roomno){
                                rooms.push(json.r_roomno[i]);
                                if (json.r_roomno[i].charAt(0) != floor){
                                
                                    floor = json.r_roomno[i].charAt(0);
                                    collapseno = "collapse"+floor;
                                    
                                    source = source 
                                        +"</div></div></div><br>"
                                        +"<div class='accordion-group'>"
                                        +"<div class='accordion-heading'>"
                                        +"<a class='accordion-toggle' data-toggle='collapse' href='#" + collapseno + "'>" + floor + "F</a> </div>"
                                        +"<div id='" + collapseno + "' class='accordion-body collapse in'>"
                                        +"<div class='accordion-inner'>"
                                        
                                        //+"<a href='#RoomInfoPage' style='font-weight:normal; color:black; text-decoration:none;'>"
                                        +"<table id='" + json.r_roomno[i] + "_status' class='stat1' onclick='detail(\""+building+"\", "+json.r_roomno[i]+");'>"
                                        +   "<tr>"
                                        +       "<th colspan='2'><center>" + json.r_roomno[i] + "</center></th>"
                                        +   "</tr>"
                                        +   "<tr>"
                                        +        "<td><center><img id='" + json.r_roomno[i] + "_light' src='img/light_off.png' style='width:45%;'></center></td>"
                                        +        "<td><center><img id='" + json.r_roomno[i] + "_door' src='img/door_close.png' style='width:45%;'></center></td>"
                                        +   "</tr>"
                                        +   "<tr align='center'>"
                                        +        "<td>Temp.</td>"
                                        +        "<td id='" + json.r_roomno[i] + "_temp'>0c</td>"
                                        +    "</tr>"
                                        +    "<tr align='center'>"
                                        +        "<td>Hum.</td>"
                                        +        "<td id='" + json.r_roomno[i] + "_hum'>0%</td>"
                                        +    "</tr>"
                                        +"</table>";
                                        //+"</a>";
                                        
                                }else{
                                    source = source
                                        //+"<a href='#RoomInfoPage' style='font-weight:normal; color:black; text-decoration:none;'>"
                                        +"<table id='" + json.r_roomno[i] + "_status' class='stat1' onclick='detail(\""+building+"\", "+json.r_roomno[i]+");'>"
                                        +   "<tr>"
                                        +       "<th colspan='2'><center>" + json.r_roomno[i] + "</center></th>"
                                        +   "</tr>"
                                        +   "<tr>"
                                        +        "<td><center><img id='" + json.r_roomno[i] + "_light' src='img/light_off.png' style='width:45%;'></center></td>"
                                        +        "<td><center><img id='" + json.r_roomno[i] + "_door' src='img/door_close.png' style='width:45%;'></center></td>"
                                        +   "</tr>"
                                        +   "<tr align='center'>"
                                        +        "<td>Temp.</td>"
                                        +        "<td id='" + json.r_roomno[i] + "_temp'>0c</td>"
                                        +    "</tr>"
                                        +    "<tr align='center'>"
                                        +        "<td>Hum.</td>"
                                        +        "<td id='" + json.r_roomno[i] + "_hum'>0%</td>"
                                        +    "</tr>"
                                        +"</table>";
                                        //+"</a>";
                                }
                                
                            }
                            tester = "";
                            for(i in rooms){
                                tester = tester + rooms[i] + " ";
                            }
                            //alert(tester);
                            
                            
                            source = source + "</div></div></div></div>";
                        }
                        
                        $('#buildinginfo').html(source);
                        
                        element = document.getElementById('buildinginfo');
                        var searchThis = element.innerHTML;
                        //alert(searchThis);
                        //alert(tester);
                        
                        roomreload(building, json);
                        intervalRoomInfo = setInterval(function(){
                            
                            roomreload(building, json);
                        }, 2000);
                        
                        
                        $.mobile.changePage( "#BuildingInfoPage", 
                            { transition: "pop", 
                            changeHash: true, 
                            reverse :true }
                        );
                    },
                    error: function failCallBk(XMKHttpRequest, textStatus, errorThrown){
                        alert(XMKHttpRequest.status + " " + XMKHttpRequest.statusText + " " + errorThrown + "\n" +"An error occured while processing your request. Please try again.");
                    } 
                });
                
            }
            
            function roomreload(building, json){
            
                $.ajax({
                    url:"http://seongjo03.gonetis.com/capstone/sensorR.php",
                    data: {r_building: building},
                    dataType: "json",
                    success: function(json2){
                        
                        for(var i in json.r_roomno){
                            document.getElementById(json.r_roomno[i]+"_status").className = "stat2";
                        }
                        for(var i in json2.r_roomno){
                            document.getElementById(json.r_roomno[i]+"_status").className = "stat1";
                            if(json2.r_light[i] == 1){
                                document.getElementById(json2.r_roomno[i]+"_light").src = 'img/light_on.png';
                            }else{
                                document.getElementById(json2.r_roomno[i]+"_light").src = 'img/light_off.png';
                            }
                            if(json2.r_door[i] == 1){
                                document.getElementById(json2.r_roomno[i]+"_door").src = 'img/door_open.png';
                            }else{
                                document.getElementById(json2.r_roomno[i]+"_door").src = 'img/door_close.png';
                            }
                            document.getElementById(json2.r_roomno[i]+"_temp").innerHTML = json2.r_temp[i];
                            document.getElementById(json2.r_roomno[i]+"_hum").innerHTML = json2.r_hum[i];
                        }

                    },
                    error: function failCallBk(XMKHttpRequest, textStatus, errorThrown){
                    console.log(XMKHttpRequest.status + " " + XMKHttpRequest.statusText + " " + errorThrown + "\n" +"An error occured while processing your request. Please try again.");
                    } 
                });
            }
            
            function detail(building, roomno){
                //console.log(building + " " + roomno);
                /*
                <!--
                <h3><center>A001</center></h3>
                <div align="center">
                    <img src="img/sample_chart.png"></img>
                </div>
                <table align="center">
                    <tr align="center">
                        <td style="padding:10px;"> Door State</td>
                        <td style="padding:10px;"> Open </td>
                    </tr>
                    <tr align="center">
                        <td style="padding:10px;"> Light</td>
                        <td style="padding:10px;"> On </td>
                    </tr>
                </table>
            </div>
            -->
            */
                var source = "";
                source = source
                    + "<h3><center>" + building + "-" + roomno + "</center></h3>"
                    + "<div align='center'>"
                    + "<img src='img/sample_chart.png'></img>"
                    + "</div>"
                    + "<table align='center'>"
                    + "<tr align='center'>"
                    + "<td style='padding:10px;'>Door State</td>"
                    + "<td style='padding:10px;'>Open</td>"
                    + "</tr>"
                    + "<tr align='center'>"
                    + "<td style='padding:10px;'>Light</td>"
                    + "<td style='padding:10px;'>On</td>"
                    + "</tr>"
                    + "</table>";
                    
                document.getElementById('roominfo').innerHTML = source;
                
                $.mobile.changePage( "#RoomInfoPage", 
                    { transition: "pop", 
                    changeHash: false, 
                    reverse :true }
                );
            }
            
        </script>
        
        <div data-role="page" id="LoginPage">
            
            <img src="img/building2.png" style="z-index:2; position: absolute; height:20%; width:30%; top: 12%; left: 35%;"></img>
            <div class="blink"><img src="img/building2_3.png" style="z-index:3; position: absolute; height:20%; width:30%; left: 35%; top: 12%;"></img></div>
            <div class="container" style="z-index:1; background-color:#f8f8f8; position: absolute; width: 80%; height: 50%; left: 10%; top: 30%; padding:0px">
                <h2 style="padding:16px;"><center>App name</center></h2>
                <ul class="nav nav-tabs">
                    <li class="active" style="width:50%;"><a data-toggle="tab" href="#Login">Login</a></li>
                    <li style="width:50%;"><a data-toggle="tab" href="#Register">Register</a></li>
                </ul>

                <div class="tab-content" style="padding:10px;">
                    <div id="Login" class="tab-pane fade in active">
                        
                            <table>
                                <tr style="padding:0px;">
                                    <td style="padding:0px;"><input type="text" id="email" placeholder="Email Address" value="seongjo03@naver.com"></input></td>
                                </tr>
                                <tr style="padding:0px;">
                                    <td style="width:1000px;"><input type="password" id="pass" placeholder="Password" value="1234"></input></td>
                                </tr>
                                <tr>
                                    
                                    <td>
                                    <button id="loginBtn" style="font-family: 'Times New Roman'; color: #f8f8f8; text-shadow:0 0 0; background: #006a60;">Login</button>
                                    
                                    </td>
                                </tr>
                            </table>
                        
                    </div>
                    <div id="Register" class="tab-pane fade">
                        <p><center>Register Page.</center></p>
                    </div>
                </div>
            </div>
        </div>
        
        
        <!-- Building Choose page**************************** -->
        <div data-role="page" id="bcpage" style="background-color:#f1f1f1;">
            
            
            <div id="myCarousel" class="carousel slide" data-ride="carousel" style="position: absolute; top: 30%; width:100%;">
                <!-- Indicators -->
                <ol class="carousel-indicators" id="carousel-indicators">
                <!--
                    <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                    <li data-target="#myCarousel" data-slide-to="1"></li>
                    -->
                </ol>

                <!-- Wrapper for slides -->
                <div class="carousel-inner" id="carousel-inner" role="listbox">
                <!--
                    <div class="item active">
                        <a href="#BuildingInfoPage">
                            <img src="img/Building_A.jpg" alt="Building_A">
                            <div class="carousel-caption">
                                <h3>Lecture Building A</h3>
                                <p>Cultural studies</p>
                            </div>
                        </a>
                    </div>

                    <div class="item">
                        <a href="#BuildingInfoPage">    
                            <img src="img/Building_B.jpg" alt="Building_B">
                            <div class="carousel-caption">
                                <h3>Lecture Building B</h3>
                                <p></p>
                            </div>
                        </a>
                    </div>
                    -->
                </div>

                <!-- Left and right controls -->
                <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
                    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
                    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
            
            
        </div>
        
        <!-- Building Info page**************************** -->
        <div data-role="page" id="BuildingInfoPage">
            <div class="container" id="buildinginfo" style="background-color: #f1f1f1; margin:20px; padding-bottom:20px; font-family: 'Times New Roman', Times, serif;">
            <!-- sample
                <h2>Lecture Building A</h2>
                <div class="accordion" id="accordion2">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <a class="accordion-toggle" data-toggle="collapse" href="#collapseOne">
                                0F
                            </a>
                        </div>
                        <div id="collapseOne" class="accordion-body collapse in">
                            <div class="accordion-inner">

                                 
                                <a href="#RoomInfoPage" style="font-weight:normal; color:black; text-decoration:none;">
                                    <table style="width:32%; border:solid; background-color:white; display:inline-table; margin-bottom:3px">
                                        <tr>
                                            <th colspan="2"><center>A001</center></th>
                                        </tr>
                                        <tr>
                                            <td><center><img src="img/light_on.png" style="width:45%;"></center></td>
                                            <td><center><img src="img/door_open.png" style="width:45%;"></center></td>
                                        </tr>
                                        <tr align="center">
                                            <td>Temp.</td>
                                            <td>60c</td>
                                        </tr>
                                        <tr align="center">
                                            <td>Hum.</td>
                                            <td>88%</td>
                                        </tr>
                                    </table>
                                </a>
                            </div>
                        </div>
                    </div>
                    <br>
                    
                    <div class="accordion-group">
                        <div class="accordion-heading"> 
                            <a class="accordion-toggle" data-toggle="collapse" href="#collapseTwo">
                                1F
                            </a>
                        </div>
                        <div id="collapseTwo" class="accordion-body collapse in">
                            <a href="#RoomInfoPage" style="font-weight:normal; color:black; text-decoration:none;">
                                <table style="width:32%; border:solid; background-color:white; display:inline-table; margin-bottom:3px">
                                    <tr>
                                        <th colspan="2"><center>A101</center></th>
                                    </tr>
                                    <tr>
                                        <td><center><img src="img/light_off.png" style="width:45%;"></center></td>
                                        <td><center><img src="img/door_close.png" style="width:45%;"></center></td>
                                    </tr>
                                    <tr align="center">
                                        <td>Temp.</td>
                                        <td>88c</td>
                                    </tr>
                                    <tr align="center">
                                        <td>Hum.</td>
                                        <td>28%</td>
                                    </tr>
                                </table>
                            </a>
                        </div>
                    </div>
                </div>
                -->
            </div>
        </div>
        
        <!-- Room Info page**************************** -->
        <div data-role="page" id="RoomInfoPage">
            <div class="container" id="roominfo" style="background-color: #f1f1f1; margin:20px; padding-bottom:10px; font-family: 'Times New Roman', Times, serif;">
            <!--
                <h3><center>A001</center></h3>
                <div align="center">
                    <img src="img/sample_chart.png"></img>
                </div>
                <table align="center">
                    <tr align="center">
                        <td style="padding:10px;"> Door State</td>
                        <td style="padding:10px;"> Open </td>
                    </tr>
                    <tr align="center">
                        <td style="padding:10px;"> Light</td>
                        <td style="padding:10px;"> On </td>
                    </tr>
                </table>
            </div>
            -->
        </div>
        
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
    </body>
</html>
